<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¿å¥½è¿åå°</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="container">
  <h1>ğŸ è¿å¥½è¿åå°ç®¡ç† ğŸ</h1>

  <!-- ç™»å½•åŒº -->
  <div id="loginBox" class="login-box">
    <input type="password" id="pwd" placeholder="è¯·è¾“å…¥åå°å¯†ç " style="max-width:300px;">
    <button onclick="login()" style="max-width:300px;">ç™»å½•</button>
  </div>

  <!-- ç®¡ç†åŒºï¼ˆé»˜è®¤éšè—ï¼‰ -->
  <div id="adminPanel" style="display:none;">
    <div class="admin-box">
      <h3>â‘  å¯¼å…¥è¿å¥½è¿åå•ï¼ˆExcelï¼‰</h3>
      <input type="file" id="importUsers" accept=".xlsx,.xls">
      <button onclick="importUsers(document.getElementById('importUsers').files[0])">å¯¼å…¥åå•</button>
    </div>

    <div class="admin-box">
      <h3>â‘¡ å¯¼å…¥å¥½è¿é…ç½®ï¼ˆåç§°+é™é¢ï¼‰</h3>
      <input type="file" id="importAwards" accept=".xlsx,.xls">
      <button onclick="importAwards(document.getElementById('importAwards').files[0])">å¯¼å…¥å¥½è¿</button>
    </div>

    <div class="admin-box">
      <h3>â‘¢ è®¾ç½®è¿å¥½è¿é¡µèƒŒæ™¯å›¾</h3>
      <input type="file" id="bgFile" accept="image/*">
      <button onclick="setBg()">ä¸Šä¼ èƒŒæ™¯</button>
    </div>

    <div class="admin-box">
      <h3>â‘£ å‰©ä½™å¥½è¿ç»Ÿè®¡</h3>
      <div id="remainBox"></div>
    </div>

    <div class="admin-box">
      <h3>â‘¤ è¿å¥½è¿è®°å½•</h3>
      <button onclick="exportWinners()">å¯¼å‡ºè®°å½•ï¼ˆCSVï¼‰</button>
      <div id="winnerList"></div>
    </div>

    <div class="admin-box">
      <h3>â‘¥ æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆæ…ç”¨ï¼‰</h3>
      <button onclick="clearAll()">æ¸…ç©ºåå•/å¥½è¿/è®°å½•</button>
    </div>
  </div>
</div>

<script src="script.js"></script>
<script>
  loadBackground();

  // ç™»å½•
  function login() {
    const pwd = document.getElementById("pwd").value;
    if (checkPwd(pwd)) {
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
      renderAwards();
      renderWinners();
    } else {
      alert("å¯†ç é”™è¯¯");
    }
  }

  // æ¸²æŸ“å‰©ä½™å¥½è¿
  function renderAwards() {
    const list = getRemain();
    const el = document.getElementById("remainBox");
    if (list.length === 0) {
      el.innerHTML = "<p>æœªå¯¼å…¥å¥½è¿é…ç½®</p>";
      return;
    }
    let html = `<table class="table">
      <tr><th>å¥½è¿åç§°</th><th>æ€»é™é¢</th><th>å·²è¿</th><th>å‰©ä½™</th></tr>`;
    list.forEach(item => {
      html += `<tr>
        <td>${item.name}</td>
        <td>${item.limit}</td>
        <td>${item.count}</td>
        <td style="color:${item.remain>0?'green':'red'}">${item.remain}</td>
      </tr>`;
    });
    html += "</table>";
    el.innerHTML = html;
  }

  // æ¸²æŸ“ä¸­å¥–è®°å½•
  function renderWinners() {
    const winners = getStorage(STORAGE.WINNERS);
    const el = document.getElementById("winnerList");
    if (winners.length === 0) {
      el.innerHTML = "<p>æš‚æ— è¿å¥½è¿è®°å½•</p>";
      return;
    }
    let html = `<table class="table">
      <tr><th>å§“å</th><th>å¥½è¿</th><th>æ—¶é—´</th></tr>`;
    winners.forEach(w => {
      html += `<tr><td>${w.name}</td><td>${w.award}</td><td>${w.time}</td></tr>`;
    });
    html += "</table>";
    el.innerHTML = html;
  }

  // ä¸Šä¼ èƒŒæ™¯
  function setBg() {
    const file = document.getElementById("bgFile").files[0];
    if (!file) return alert("è¯·é€‰æ‹©å›¾ç‰‡");
    const reader = new FileReader();
    reader.onload = e => {
      setBackground(e.target.result);
      alert("èƒŒæ™¯å›¾è®¾ç½®æˆåŠŸï¼Œå‰å°å·²ç”Ÿæ•ˆ");
    };
    reader.readAsDataURL(file);
  }
</script>
</body>
</html>
